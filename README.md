# T-Rex 游戏开发文档

## 1. 游戏概述

本项目是基于 Godot 4.4 引擎开发的 T-Rex 恐龙跑酷游戏，灵感来源于 Chrome 浏览器的离线小游戏。玩家控制一只恐龙角色，通过跳跃或下蹲来避开障碍物（仙人掌和翼龙），随着游戏进行，难度会逐渐增加。

### 1.1 游戏特点

- 简单易上手的操作系统：跳跃和下蹲
- 随机生成的障碍物：仙人掌和翼龙
- 随时间增加的游戏难度
- 计分系统和游戏结束界面

## 2. 技术架构

### 2.1 开发环境

- 游戏引擎：Godot 4.4
- 编程语言：C#
- 资源格式：2D 精灵图像（PNG）

### 2.2 项目结构

```
├── Assets/              # 游戏资源文件
│   ├── Fonts/          # 字体资源
│   └── Sprites/        # 精灵图像资源
├── CollisionShapes/    # 碰撞形状资源
│   ├── cactus/        # 仙人掌碰撞形状
│   ├── dino/          # 恐龙碰撞形状
│   └── ground.tres    # 地面碰撞形状
├── Scenes/             # 场景文件
│   ├── cactus.tscn    # 仙人掌场景
│   ├── ground.tscn    # 地面场景
│   ├── main.tscn      # 主场景
│   ├── player.tscn    # 玩家场景
│   ├── pterodactyl.tscn # 翼龙场景
│   └── ui.tscn        # UI场景
└── Scripts/            # 脚本文件
	├── Cactus.cs      # 仙人掌脚本
	├── Ground.cs      # 地面脚本
	├── Main.cs        # 主场景脚本
	├── ObstacleSpawner.cs # 障碍物生成器脚本
	├── Player.cs      # 玩家脚本
	├── Pterodactyl.cs # 翼龙脚本
	└── UI.cs          # UI脚本
```

## 3. 游戏组件详解

### 3.1 玩家（Player）

玩家控制的恐龙角色，具有以下功能：

- **移动机制**：
  - 跳跃：按空格键、W键或上箭头键
  - 下蹲：按S键或下箭头键
- **状态**：
  - 奔跑（默认）
  - 跳跃
  - 下蹲
  - 死亡
- **碰撞检测**：与障碍物（仙人掌和翼龙）碰撞时触发游戏结束
- **动画**：
  - 奔跑动画
  - 下蹲动画
  - 死亡动画

### 3.2 地面（Ground）

游戏的地面系统，具有以下功能：

- **无限滚动**：两个地面精灵交替移动，创造无限滚动效果
- **速度控制**：随着游戏难度增加，地面滚动速度会增加
- **障碍物生成**：包含ObstacleSpawner节点，负责生成障碍物

### 3.3 障碍物生成器（ObstacleSpawner）

负责生成游戏中的障碍物，具有以下功能：

- **随机生成**：根据概率生成不同类型的障碍物（仙人掌或翼龙）
- **难度调整**：随着游戏进行，生成频率增加，翼龙出现概率增加
- **障碍物类型**：
  - 仙人掌：有6种不同的形态（大/小，单/双/三个）
  - 翼龙：在空中飞行的障碍物

### 3.4 仙人掌（Cactus）

地面上的静态障碍物，具有以下特点：

- **多种形态**：6种不同的仙人掌形态，有不同的碰撞区域
- **自动销毁**：离开屏幕后自动销毁

### 3.5 翼龙（Pterodactyl）

空中的动态障碍物，具有以下特点：

- **飞行动画**：翅膀扇动的动画效果
- **随机高度**：在不同高度生成，增加游戏难度
- **自动销毁**：离开屏幕后自动销毁

### 3.6 用户界面（UI）

游戏的界面系统，包括：

- **计分系统**：显示当前得分
- **难度增加**：每达到特定分数（默认50分）增加一次游戏难度
- **游戏结束界面**：
  - 显示"Game Over"文本
  - 重新开始按钮

## 4. 游戏流程

### 4.1 游戏初始化

1. 加载主场景（main.tscn）
2. 初始化玩家、地面和UI组件
3. 开始地面滚动
4. 启动障碍物生成器定时器

### 4.2 游戏循环

1. 玩家通过跳跃或下蹲避开障碍物
2. 障碍物定时生成并向左移动
3. 计分系统每隔一段时间（默认0.3秒）增加分数
4. 当分数达到特定值（默认每50分）时，增加游戏难度：
   - 增加地面滚动速度
   - 增加障碍物生成频率
   - 增加翼龙出现概率

### 4.3 游戏结束

1. 玩家与障碍物碰撞
2. 播放死亡动画
3. 停止地面滚动和障碍物生成
4. 显示游戏结束界面
5. 玩家可以点击重新开始按钮重新开始游戏

## 5. 物理系统

### 5.1 碰撞层设置

游戏使用Godot的物理层系统进行碰撞检测：

- 第1层：玩家（Player）
- 第2层：地面（Ground）
- 第3层：障碍物（Obstacles）

### 5.2 碰撞形状

- **恐龙**：两种碰撞形状
  - 默认形状（直立）
  - 下蹲形状（更低矩形）
- **仙人掌**：6种不同的碰撞形状，对应不同的仙人掌类型
- **翼龙**：矩形碰撞形状
- **地面**：矩形碰撞形状

## 6. 信号系统

游戏中使用Godot的信号（Signal）系统进行组件间通信：

- **Player.ObstacleHit**：玩家碰到障碍物时触发
  - 接收者：Ground（停止移动）、UI（显示游戏结束界面）
- **UI.IncreaseDifficulty**：达到特定分数时触发
  - 接收者：Ground（增加速度）、ObstacleSpawner（增加难度）
- **VisibleOnScreenNotifier2D.ScreenExited**：障碍物离开屏幕时触发
  - 接收者：障碍物自身（销毁）

## 7. 移动端适配

### 7.1 触摸控制

要在手机屏幕上控制游戏，可以实现以下触摸控制方案：

- **点击屏幕左半部分**：触发跳跃动作（等同于空格键/W键/上箭头）
- **点击屏幕右半部分**：触发下蹲动作（等同于S键/下箭头）
- **滑动手势**：可选择性地实现上滑跳跃、下滑下蹲的手势控制

### 7.2 屏幕适配

为确保游戏在不同尺寸的移动设备上正常显示：

- 使用Godot的自适应布局系统（Control节点和锚点）
- 根据屏幕方向（横屏/竖屏）调整游戏界面
- 为不同分辨率准备适当缩放的资源

### 7.3 性能考虑

移动设备上的性能优化：

- 减少粒子效果和复杂图形
- 优化碰撞检测
- 考虑电池消耗，适当降低帧率

## 8. 游戏素材替换指南

要替换游戏中的素材，请按照以下步骤操作：

1. **准备新素材**：
   - 确保新素材的尺寸与原素材相近
   - 保存为PNG格式（推荐透明背景）
   - 为动画帧准备多个图像（如奔跑动画需要2帧）

2. **替换方法**：
   - 将新素材放入`Assets/Sprites/`目录
   - 在Godot编辑器中打开相应场景（如`player.tscn`）
   - 选择精灵节点，在检查器中更改纹理属性
   - 对于动画，需要在AnimatedSprite2D节点中更新每个动画帧

3. **调整碰撞形状**：
   - 如果新素材尺寸与原素材差异较大，需要调整碰撞形状
   - 在场景中选择CollisionShape2D节点
   - 在检查器中调整形状大小和位置

## 9. 扩展建议

### 9.1 功能扩展

- **多种角色**：添加可选的不同恐龙角色
- **能力道具**：添加可收集的道具，如临时无敌、双倍得分等
- **日夜循环**：添加随时间变化的背景和光照效果
- **声音效果**：添加跳跃、碰撞和背景音乐
- **高分记录**：添加本地或在线排行榜

### 9.2 性能优化

- **对象池**：使用对象池技术重用障碍物对象，减少实例化和销毁开销
- **视觉优化**：添加粒子效果、过渡动画等增强视觉体验
- **移动平台适配**：优化触摸控制和屏幕适配

## 10. 移动平台适配

为了使游戏能够在移动设备上良好运行，我们实现了以下适配功能：

### 10.1 触摸控制

游戏添加了专门为触摸屏设计的控制界面，包括：

- **触摸按钮**：屏幕左侧的跳跃按钮和右侧的下蹲按钮
- **自动检测**：系统会自动检测是否为移动平台，仅在移动设备上显示触摸控制
- **屏幕分区**：除了按钮外，触摸屏幕左半部分也会触发跳跃，右半部分触发下蹲

触摸控制的实现主要通过以下组件：

1. `TouchControls.cs`：管理触摸按钮的显示和行为
2. `Player.cs`中的`HasTouchJumpInput()`方法：检测屏幕触摸输入

### 10.2 屏幕适配

为适应不同尺寸和分辨率的移动设备屏幕，游戏实现了自动屏幕适配功能：

- **自动缩放**：根据设备屏幕尺寸自动调整游戏视图
- **保持纵横比**：确保游戏画面不会变形
- **UI元素适配**：动态调整UI元素大小，确保在小屏幕上仍然清晰可见

屏幕适配主要通过`ScreenAdapter.cs`脚本实现，它会：

1. 监听窗口大小变化
2. 计算适当的缩放比例
3. 调整游戏元素大小
4. 针对移动平台优化触摸按钮和UI文本大小

### 10.3 性能优化

为确保在性能较低的移动设备上流畅运行，实施了以下优化：

- **简化物理计算**：减少不必要的物理计算
- **资源管理**：优化资源加载和释放
- **渲染优化**：减少绘制调用次数

## 11. 总结

本T-Rex游戏是一个基于Godot引擎的简单但完整的2D游戏示例，展示了基本的游戏开发概念，包括角色控制、碰撞检测、无限滚动背景、随机障碍物生成、难度递增和UI系统。通过模块化的设计和Godot的场景系统，游戏具有良好的可扩展性和可维护性。
